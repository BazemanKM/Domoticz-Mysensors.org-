    commandArray = {}
     
    SAMPLE_INTERVAL = 5                 -- time in minutes when a the script logic will happen
    FAN_DELTA_TRIGGER = 5               -- rise in humidity needed for a bath that will trigger the fan
    FAN_DELTA_TRIGGER2 = 10             -- rise in humidity needed for a shower that will trigger the fan
    FAN_DELTA_TRIGGER3 = 15
    FAN_MAX_TIME = 20                   --  maximum amount of sample cycles the fan can be on,
                                        -- in case we never reach the target humidity
    TARGET_OFFSET = 2                   -- ventilator goes off if target+offset is reached
    FAN_NAME = 'Ventilator 1'           -- exact device name of the switch turning on/off the ventilator 1
    FAN_NAME2 = 'Ventilator 2'           -- exact device name of the switch turning on/off the ventilator 2
    FAN_NAME3 = 'Ventilator 3'           -- exact device name of the switch turning on/off the ventilator 3
    SENSOR_NAME = 'Badkamertemperatuur'     -- exact device name of the humidity sensor
     
    humCounter = tonumber(uservariables['humCounter'])
    humidityTmin5 = tonumber(uservariables['humidityTmin5'])                
    humidityTmin10 = tonumber(uservariables['humidityTmin10'])              
    targetFanOffHumidity = tonumber(uservariables['targetFanOffHumidity'])  
    fanMaxTimer = tonumber(uservariables['fanMaxTimer'])
     
    current = otherdevices_humidity[SENSOR_NAME]
     
    -- check if the sensor is on or has some weird reading
    if (current == 0 or current == nil) then
        print('current is 0 or nil. Skipping this reading')
        return commandArray
    end
     
    humCounter = humCounter + 1
     
    if (humCounter >= SAMPLE_INTERVAL) then
     
        if (humidityTmin5 == 0) then
            humidityTmin5 = current
            humidityTmin10 = current
        end
     
        humCounter = 0 -- reset the cycle counter
     
        delta = current - math.min(humidityTmin10, humidityTmin5)
     
        target = math.min(humidityTmin10, humidityTmin5) + TARGET_OFFSET
     
        humidityTmin10 = humidityTmin5
        humidityTmin5 = current
     
    end
     
    -- save the globals
    commandArray['Variable:humCounter'] = tostring(humCounter)
    commandArray['Variable:humidityTmin10'] = tostring(humidityTmin10)
    commandArray['Variable:humidityTmin5'] = tostring(humidityTmin5)
    commandArray['Variable:targetFanOffHumidity'] = tostring(targetFanOffHumidity)
    commandArray['Variable:fanMaxTimer'] = tostring(fanMaxTimer)
     
    return commandArray
